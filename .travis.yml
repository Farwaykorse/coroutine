#
#   Author
#     - luncliff@gmail.com
#
sudo: false

git:
  submodules: true
  depth: 5

branches:
  except:
    - docs

notifications:
  email:
    - luncliff@gmail.com

os: linux
dist: xenial
addons:
<<<<<<< HEAD
  homebrew:
    update: true
    packages:
      - ninja
      - tree
      - cmake

=======
>>>>>>> dev/gcc
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - llvm-toolchain-xenial-7
      - llvm-toolchain-xenial-8
    packages:
      - g++-7
      - g++-8
      - libc++-7-dev
      - libc++abi-7-dev
      - unzip
      - curl
      - ninja-build
      - tree
      - jq

services:
  - docker

matrix:
  allow_failures:
    - os: linux
  include:
    - name: Docker Image / Version Info
      before_install:
        - docker info
      install:
        - docker pull luncliff/gcc
      script:
        - docker inspect luncliff/gcc | jq
        - docker run --rm luncliff/gcc gcc-10 --version

    - name: CMake + Debug
      env:
        - CONFIG=Debug
      install:
        - docker pull luncliff/gcc
        - docker run -it -d --name gcc_10_builder -w /code/build -v $(pwd):/code luncliff/gcc
      before_script:
        - export RUN="docker exec gcc_10_builder"
        - $RUN apt install -y -qq cmake rsync wget tar unzip
        - $RUN cmake --version
      script:
        - $RUN cmake .. -DCMAKE_CXX_COMPILER=gcc-10 -DCMAKE_BUILD_TYPE=${CONFIG}
        - $RUN make -k
        - $RUN ctest --output-on-failure

    - name: CMake + Release
      env:
        - CONFIG=Release
      install:
        - docker pull luncliff/gcc
        - docker run -it -d --name gcc_10_builder -w /code/build -v $(pwd):/code luncliff/gcc
      before_script:
        - export RUN="docker exec gcc_10_builder"
        - $RUN apt install -y -qq cmake rsync wget tar unzip
        - $RUN cmake --version
      script:
        - $RUN cmake .. -DCMAKE_CXX_COMPILER=gcc-10 -DCMAKE_BUILD_TYPE=${CONFIG}
        - $RUN make -k
        - $RUN ctest --output-on-failure
